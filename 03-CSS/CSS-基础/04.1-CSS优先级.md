
# 优先级

## 计算权重

一个选择器的优先级可以说是由三个不同的值（或分量）相加，可以认为是百（ID）十（类）个（元素）——三位数的三个位数：

- ID：选择器中包含 ID 选择器则百位得一分。
- 类：选择器中包含类选择器、属性选择器或者伪类则十位得一分。
- 元素：选择器中包含元素、伪元素选择器则个位得一分。

> 备注： 通用选择器（`*`）、组合符（`+`、`>`、`~`、' '）和调整优先级的选择器（`:where()`）不会影响优先级。

否定（`:not()`）和任意匹配（`:is()`）伪类本身对优先级没有影响，但它们的参数则会带来影响。参数中，对优先级算法有贡献的参数的优先级的最大值将作为该伪类选择器的优先级。

选择器 |ID |类 |元素 |优先级
--|--|--|--|--
`h1` |0 |0 |1 |0-0-1
`h1 + p::first-letter`| 0 |0 |3 |0-0-3
`li > a[href*="en-US"] > .inline-warning` |0 |2 |2| 0-2-2
`#identifier` | 1| 0 |0 |1-0-0
`button:not(#mainBtn, .cta)` |1 |0 |1 |1-0-1

[例子：优先级.html](Code/优先级/优先级.html)

**备注：** 每一个选择器类编都有它自己的优先级等级，它们不会被具有较低优先级的选择器覆盖。例如，权重为一百万的类选择器不会覆盖权重为一的 ID 选择器。

评估优先级的最佳方法是对不同的优先级等级单独进行评分，并从最高的等级开始，必要时再计算低优先级等级的权重。即，仅当某一列的优先级权重相同时，你才需要评估下一列；否则，你可以直接忽略低等级的选择器，因为它们无法覆盖高优先级等级的选择器。

### 内联样式

内联样式，即 style 属性内的样式声明，优先于所有普通的样式，无论其优先级如何。这样的声明没有选择器，但它们的优先级可以理解为 `1-0-0-0`；即无论选择器中有多少个 ID，它总是比其他任何优先级的权重都要高。

### !important

有一个特殊的 CSS 可以用来覆盖所有上面所有优先级计算，不过需要很小心的使用——!important。用于修改特定属性的值，能够覆盖普通规则的层叠。

[例子：!important](Code/优先级/!important.html)

> **备注：** 覆盖 !important 唯一的办法就是另一个 !important 具有相同优先级而且顺序靠后，或者更高优先级。

在一种情况下，你可能不得不使用它：当你不能编辑核心的 CSS 模块，不能用任何其他方式覆盖，而你又真的想要覆盖一个样式时。但说真的，如果可以避免的话就不要用它。

## CSS 位置的影响

最后，也很有用，CSS 声明的优先级取决于定义它的样式表和级联层。

它让用户可以设置自定义样式表来覆盖开发人员定义的样式。例如用户可能视力受损，并想在所有网页上设置两倍的正常字体大小，以便更容易进行阅读。

也可以在级联层中声明开发人员定义的样式：你可以让非分层样式覆盖分层样式，或者你可以让后面的层中声明的样式覆盖先前的层中声明的样式。例如，作为开发人员，你可能无法编辑第三方的样式表，但你可以将外部的样式表导入级联层中，以便你自己的样式可以轻松地覆盖导入的样式，无需担心第三方选择器的优先级。

### 覆盖声明的顺序

相互冲突的声明将按以下顺序应用，后一种声明将覆盖前一种声明：

```html
用户代理样式表中的声明：浏览器默认的样式，无需修改。

用户样式表中的常规声明: 修改游览器的配置。游览器的设置里，默认字体 颜色等。

作者样式表中的常规声明: 使用HTML的<link>元素在HTML文档中链接样式表。
    <link rel="stylesheet" type="text/css" href="styles.css">

作者样式表中的 `!important` 声明：

用户样式表中的 `!important` 声明：

用户代理样式表中的 `!important` 声明：
```

权重小的被权重大的覆盖。权重由高到低为：**浏览器缺省值<外部样式<内部样式<内联样式**。

1. **用户代理样式表中的声明：** 这是浏览器默认的样式。这些样式在没有其他样式表或用户定义的样式影响的情况下应用于网页。
2. **用户样式表中的常规声明：** 用户可以通过浏览器设置自己的样式。这些样式优先于浏览器默认样式，但可能被作者定义的样式覆盖。
3. **作者样式表中的常规声明：** 这是网页开发者定义的样式。当存在冲突时，这些样式优先于用户定义的样式。
4. **作者样式表中的 `!important` 声明：** 在CSS中，使用 `!important` 可以使一个声明优先于其他声明，即使它们在其他地方有更高的特异性。但要谨慎使用，因为这会使代码更难维护和理解。
5. **用户样式表中的 `!important` 声明：** 与作者定义的 `!important` 声明类似，用户定义的 `!important` 声明也会覆盖其他所有声明，但它们通常是为了覆盖作者定义的 `!important` 声明。
6. **用户代理样式表中的 `!important` 声明：** 这可能是最优先的样式，因为它覆盖了所有其他声明。但是，在实践中，很少或从未见过这样的声明。

优先级规则的总结：

- 内联样式的优先级高于任何其他样式表。
- ID选择器的优先级高于类选择器、属性选择器和伪类选择器。
- `!important` 规则可以覆盖其他任何声明，除非另一个 `!important` 规则具有更高的特异性。
- 作者定义的样式优先于用户定义的样式。
- 在没有其他规则的情况下，浏览器默认样式会应用。

备注： 标记为 `!important` 的样式的优先级顺序是颠倒的。web 开发人员的样式表覆盖用户的样式表是有意义的，因此设计可以按预期进行，但是有时用户有充足的理由覆盖 web 开发人员的样式，正如上面提到的——这可以通过在他们的规则中使用 `!important` 来实现。

## 级联层的顺序

尽管级联层属于高级的主题，你可能不会立刻使用此特性，但了解层是如何级联的非常重要。

- 在级联层中声明 CSS 是，优先级的顺序由声明层的顺序来决定。
- 在任何层之外声明的 CSS 样式会被按声明的顺序组合在一起，形成一个未命名的层，它会被当作最后声明的层。
- 对于存在冲突的常规（没有 !important 声明）样式，后面的层比先前定义的层的优先级高。
- 但对于带有 !important 标记的样式，其顺序相反——先前的层中的 important 样式比后面的层以及为在层中声明的 important 样式优先级要高。
- 但内联样式比所有作者定义的样式的优先级都要高，不受级联层规则的影响。

当你在不同的层中有多个样式块，且其中提供了对于某一元素的单一属性的相互冲突的值时，声明该冲突样式的层的顺序将决定其优先级。而不是高优先级的层直接覆盖低优先级的层中的所有样式。需要注意的是单独的一个层中的样式的优先级仍旧会起作用。

[级联层的顺序.html](Code/优先级/级联层的顺序.html)
